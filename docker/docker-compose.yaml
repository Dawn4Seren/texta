# When deploying with Docker, it is necessary to change all occurances of "localhost" to the service name of the
# Elasticsearch container inside Django. ex "http://localhost:9200" -> "http://elastic:9200".

# Environment and ulimits make sure that the system has enough memory access, as recommended by the official
# Elasticsearch documentation for Docker.
version: "2"

services:
  elastic:
    container_name: texta-elastic
    image: texta/db:latest
    build: ./elasticsearch
    environment:
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ulimits:
      memlock:
        soft: -1
        hard: -1
    ports:
      - "9200"
    networks:
      - texta-network

  texta:
    container_name: texta-toolkit
    image: texta/toolkit:latest
    build: ./texta
    ports:
      - "8000:80"
    networks:
      - texta-network
    volumes:
      - texta-data-volume:/home/texta/texta/texta/data
      - texta-state-volume:/home/texta/texta/texta/database

networks:
  texta-network:
    driver: bridge

volumes:
  texta-data-volume:
  texta-state-volume:
